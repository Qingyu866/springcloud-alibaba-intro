# Prometheus ServiceMonitor 配置
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: springcloud-alibaba-services
  namespace: springcloud-alibaba
  labels:
    app: springcloud-alibaba
    release: prometheus
spec:
  selector:
    matchLabels:
      app: springcloud-alibaba
  namespaceSelector:
    matchNames:
      - springcloud-alibaba
  endpoints:
    - port: management
      path: /actuator/prometheus
      interval: 30s
      scrapeTimeout: 10s
      relabelings:
        - sourceLabels: [__meta_kubernetes_pod_name]
          targetLabel: pod
        - sourceLabels: [__meta_kubernetes_pod_node_name]
          targetLabel: node
        - sourceLabels: [__meta_kubernetes_namespace]
          targetLabel: namespace
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: mysql-monitor
  namespace: springcloud-alibaba
  labels:
    app: mysql
    release: prometheus
spec:
  selector:
    matchLabels:
      app: mysql
  namespaceSelector:
    matchNames:
      - springcloud-alibaba
  endpoints:
    - port: metrics
      interval: 30s
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: redis-monitor
  namespace: springcloud-alibaba
  labels:
    app: redis
    release: prometheus
spec:
  selector:
    matchLabels:
      app: redis
  namespaceSelector:
    matchNames:
      - springcloud-alibaba
  endpoints:
    - port: metrics
      interval: 30s
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: nacos-monitor
  namespace: springcloud-alibaba
  labels:
    app: nacos
    release: prometheus
spec:
  selector:
    matchLabels:
      app: nacos
  namespaceSelector:
    matchNames:
      - springcloud-alibaba
  endpoints:
    - port: client-port
      path: /nacos/actuator/prometheus
      interval: 30s
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: seata-monitor
  namespace: springcloud-alibaba
  labels:
    app: seata
    release: prometheus
spec:
  selector:
    matchLabels:
      app: seata
  namespaceSelector:
    matchNames:
      - springcloud-alibaba
  endpoints:
    - port: metrics
      interval: 30s
